<div class="container mt-4">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="/home">Home</a></li>
      <li class="breadcrumb-item"><a href="/browse">Products</a></li>
      <li class="breadcrumb-item active">{{product.displayTitle}}</li>
    </ol>
  </nav>

  <div class="row">
    <!-- Product Image -->
    <div class="col-md-5">
      <div class="card">
        <img src="{{product.imagepath}}" class="card-img-top" alt="{{product.displayTitle}}" style="max-height: 400px; object-fit: contain; padding: 20px;">
      </div>
    </div>

    <!-- Product Info -->
    <div class="col-md-7">
      <h2>{{product.displayTitle}}</h2>
      <div class="mb-3">
        <span class="badge badge-primary">{{#if (eq product._type 'dogfood')}}Dog Food{{else}}Supply{{/if}}</span>
      </div>
      
      <h3 class="text-success mb-4">${{product.displayPrice}}</h3>
      
      <div class="mb-4">
        <h5>Description</h5>
        <p class="text-muted" style="white-space: pre-line;">{{#if product.longDescription}}{{product.longDescription}}{{else}}{{product.displayDescription}}{{/if}}</p>
      </div>

      <!-- Add to Cart -->
      <div class="mb-4">
        <a href="/cart/add/{{product._type}}/{{product._id}}" class="btn btn-success btn-lg btn-block">
          <i class="fas fa-shopping-cart"></i> Add to Cart
        </a>
      </div>

      <!-- Product Features -->
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="mb-0">Product Features</h5>
        </div>
        <div class="card-body">
          <ul class="list-unstyled">
            {{#if (eq product._type 'dogfood')}}
              <li><i class="fas fa-check text-success"></i> Premium quality ingredients</li>
              <li><i class="fas fa-check text-success"></i> Balanced nutrition for dogs</li>
              <li><i class="fas fa-check text-success"></i> Suitable for all breeds</li>
              <li><i class="fas fa-check text-success"></i> No artificial preservatives</li>
            {{else}}
              <li><i class="fas fa-check text-success"></i> Durable and long-lasting</li>
              <li><i class="fas fa-check text-success"></i> Safe for pets</li>
              <li><i class="fas fa-check text-success"></i> Easy to clean</li>
              <li><i class="fas fa-check text-success"></i> High-quality materials</li>
            {{/if}}
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Reviews Section -->
  <div class="row mt-5">
    <div class="col-12">
      <h3 class="mb-4">Customer Reviews</h3>
      
      <!-- Review Summary -->
      <div class="card mb-4" id="review-summary">
        <div class="card-body">
          <div class="row align-items-center">
            <div class="col-md-3 text-center">
              <h1 class="display-4" id="avg-rating">--</h1>
              <div class="text-warning mb-2" id="avg-stars">
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
              </div>
              <p class="text-muted" id="total-reviews">Loading...</p>
            </div>
            <div class="col-md-9" id="rating-distribution">
              <!-- Distribution bars will be populated by JavaScript -->
            </div>
          </div>
        </div>
      </div>

      <!-- Individual Reviews Container -->
      <div id="reviews-container">
        <div class="text-center">
          <div class="spinner-border" role="status">
            <span class="sr-only">Loading reviews...</span>
          </div>
        </div>
      </div>

      <!-- Write Review Button -->
      <div class="text-center mt-4 mb-4">
        <button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#writeReviewModal">
          <i class="fas fa-edit"></i> Write a Review
        </button>
      </div>
    </div>
  </div>

  <!-- Related Products -->
  <div class="row mt-5 mb-5">
    <div class="col-12">
      <h3 class="mb-4">You May Also Like</h3>
      <div class="alert alert-info">
        <i class="fas fa-info-circle"></i> Check out our <a href="/browse">full catalog</a> for more products!
      </div>
    </div>
  </div>
</div>

<!-- Write Review Modal -->
<div class="modal fade" id="writeReviewModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Write a Review</h5>
        <button type="button" class="close" data-dismiss="modal">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="review-form">
          <div class="form-group">
            <label>Rating *</label>
            <div id="star-input" style="font-size: 24px; cursor: pointer;">
              <i class="far fa-star star-rating" data-rating="1"></i>
              <i class="far fa-star star-rating" data-rating="2"></i>
              <i class="far fa-star star-rating" data-rating="3"></i>
              <i class="far fa-star star-rating" data-rating="4"></i>
              <i class="far fa-star star-rating" data-rating="5"></i>
            </div>
            <input type="hidden" id="rating-value" name="rating" value="0">
          </div>
          <div class="form-group">
            <label>Review Title *</label>
            <input type="text" class="form-control" id="review-title" name="reviewTitle" placeholder="Summary of your review" required>
          </div>
          <div class="form-group">
            <label>Your Review *</label>
            <textarea class="form-control" id="review-text" name="reviewText" rows="4" placeholder="Tell us about your experience with this product" required></textarea>
          </div>
          <div class="alert alert-info" id="review-status" style="display: none;"></div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="submit-review-btn">Submit Review</button>
      </div>
    </div>
  </div>
</div>

<script>
  // Pass product data to JavaScript
  window.productData = {
    id: '{{product._id}}',
    type: '{{product._type}}'
  };
</script>
<script src="/javascripts/product-reviews.js"></script>
